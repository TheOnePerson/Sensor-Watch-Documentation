<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Watch: Deep Sleep Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sensor Watch
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
   <div id="projectbrief">A board replacement for the classic Casio F-91W wristwatch, powered by a Microchip SAM L22 microcontroller.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Deep Sleep Control</div>  </div>
</div><!--header-->
<div class="contents">

<p>This section covers functions related to preparing for and entering BACKUP mode, the deepest sleep mode available on the SAM L22.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4503eed7b8f69f7f31129256e024cfcf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__deepsleep.html#ga4503eed7b8f69f7f31129256e024cfcf">watch_register_extwake_callback</a> (uint8_t pin, ext_irq_cb_t callback)</td></tr>
<tr class="memdesc:ga4503eed7b8f69f7f31129256e024cfcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a callback on one of the RTC's external wake pins, which can wake the device from deep sleep mode.  <a href="group__deepsleep.html#ga4503eed7b8f69f7f31129256e024cfcf">More...</a><br /></td></tr>
<tr class="separator:ga4503eed7b8f69f7f31129256e024cfcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga385b36922ec76c5fe697772f97a05846"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__deepsleep.html#ga385b36922ec76c5fe697772f97a05846">watch_store_backup_data</a> (uint32_t data, uint8_t reg)</td></tr>
<tr class="memdesc:ga385b36922ec76c5fe697772f97a05846"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores data in one of the RTC's backup registers, which retain their data in deep sleep.  <a href="group__deepsleep.html#ga385b36922ec76c5fe697772f97a05846">More...</a><br /></td></tr>
<tr class="separator:ga385b36922ec76c5fe697772f97a05846"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2de1f1012475654c4741f60808581196"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__deepsleep.html#ga2de1f1012475654c4741f60808581196">watch_get_backup_data</a> (uint8_t reg)</td></tr>
<tr class="memdesc:ga2de1f1012475654c4741f60808581196"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets 32 bits of data from the RTC's backup register, which retains its data in deep sleep.  <a href="group__deepsleep.html#ga2de1f1012475654c4741f60808581196">More...</a><br /></td></tr>
<tr class="separator:ga2de1f1012475654c4741f60808581196"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad37a6fd46f2d8b72cd371660c2d3af77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__deepsleep.html#gad37a6fd46f2d8b72cd371660c2d3af77">watch_enter_deep_sleep</a> ()</td></tr>
<tr class="memdesc:gad37a6fd46f2d8b72cd371660c2d3af77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enters the SAM L22's lowest-power mode, BACKUP.  <a href="group__deepsleep.html#gad37a6fd46f2d8b72cd371660c2d3af77">More...</a><br /></td></tr>
<tr class="separator:gad37a6fd46f2d8b72cd371660c2d3af77"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This section covers functions related to preparing for and entering BACKUP mode, the deepest sleep mode available on the SAM L22. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gad37a6fd46f2d8b72cd371660c2d3af77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad37a6fd46f2d8b72cd371660c2d3af77">&#9670;&nbsp;</a></span>watch_enter_deep_sleep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_enter_deep_sleep </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enters the SAM L22's lowest-power mode, BACKUP. </p>
<p>This function does some housekeeping before entering BACKUP mode. It first disables all peripherals except for the RTC, and disables the tick interrupt (since that would wake) us up from deep sleep. It also sets an external wake source on the ALARM button, if one was not already set. If you wish to wake from another source, such as one of the external wake interrupt pins on the 9-pin connector, set that up prior to calling this function. </p><dl class="section note"><dt>Note</dt><dd>If you have a callback set for an external wake interrupt, it will be called if triggered while in ACTIVE, IDLE or STANDBY modes, but it <em>will not be called</em> when waking from BACKUP. Waking from backup is effectively like waking from reset, except that your <a class="el" href="group__app.html#ga5d2bdd732abd6aff9e4a75e672ba94e4">app_wake_from_deep_sleep</a> function will be called. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>In initial testing, it seems like the ALARM_BTN pin (PA02 RTC/IN2) cannot wake the device from deep sleep mode. There is an errata note (Reference: 15010, linked) that says that due to a silicon bug, PB01 cannot be used as RTC/IN2. It seems though that this bug may also affect PA02. As a result — and I'm very bummed about this — you cannot use deep sleep mode unless you set up an external wake interrupt using a device on the nine-pin connector (i.e. an accelerometer with an interrupt pin). Otherwise your only option for waking will be to unscrew the watch case and press the reset button on the back of the board. <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/SAM_L22_Family_Errata_DS80000782B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/SAM_L22_Family_Errata_DS80000782B.pdf</a> </dd></dl>

</div>
</div>
<a id="ga2de1f1012475654c4741f60808581196"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2de1f1012475654c4741f60808581196">&#9670;&nbsp;</a></span>watch_get_backup_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t watch_get_backup_data </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>reg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets 32 bits of data from the RTC's backup register, which retains its data in deep sleep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reg</td><td>A register from 0-7. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An unsigned 32 bit integer with the from the backup register. </dd></dl>

</div>
</div>
<a id="ga4503eed7b8f69f7f31129256e024cfcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4503eed7b8f69f7f31129256e024cfcf">&#9670;&nbsp;</a></span>watch_register_extwake_callback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_register_extwake_callback </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ext_irq_cb_t&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a callback on one of the RTC's external wake pins, which can wake the device from deep sleep mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>Either pin A2 or pin D1, the two external wake pins on the nine-pin connector. </td></tr>
    <tr><td class="paramname">callback</td><td>The callback to be called if this pin triggers outside of deep sleep mode. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>When in normal or STANDBY mode, this will function much like a standard external interrupt situation: these pins will wake from standby, and your callback will be called. However, if the device enters deep sleep and one of these pins wakes the device, your callback WILL NOT be called. </dd></dl>

</div>
</div>
<a id="ga385b36922ec76c5fe697772f97a05846"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga385b36922ec76c5fe697772f97a05846">&#9670;&nbsp;</a></span>watch_store_backup_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_store_backup_data </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores data in one of the RTC's backup registers, which retain their data in deep sleep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>An unsigned 32 bit integer with the data you wish to store. </td></tr>
    <tr><td class="paramname">reg</td><td>A register from 0-7. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
